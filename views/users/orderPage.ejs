<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <title>teccas</title>
</head>
<body>
  




<% if(orders.length>0){%>
  <div class="container">
    <div class="col-12 tm-block-col">
      <div class="tm-bg-primary-dark tm-block tm-block-taller tm-block-scroll">
        <h2 class="tm-block-title">Orders</h2>
        
          <%for(let i=0;i<orders.length;i++){ %>
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th >No</th>
                  <th >Product</th>
                  <th >quantity</th>
                  <th >price</th>
                  <th >Status</th>
                </tr>
              </thead>
              <tbody>
                <%for(let j=0;j<orders[i].item.length;j++){%>
                  <tr >
                    <td>
                      <%=j+1%>
                    </td>
                    <td>
                      <%=orders[i].item[j].product.productName%>
                    </td>
                    <td>
                      <%=orders[i].item[j].quantity%>
                    </td>

                    <td>
                      <%let total=0 %>
                        <%=orders[i].item[j].quantity*orders[i].item[j].product.price%>
                    </td>
           <% if (orders[i].is_delivered === false && orders[i].is_returned === 0) { %>
  <td><span class="status text-info">&bull;</span> Shipped</td>
<% } else if (orders[i].is_delivered === true && orders[i].is_returned === 0) { %>
  <td><span class="status text-success">&bull;</span> Delivered</td>
<% } else if (orders[i].is_returned === 1) { %>
  <td><span class="status text-warning">&bull;</span> Returned</td>
<% } else { %>
  <td><span class="status text-danger">&bull;</span> Cancelled</td>
<% } %>```

                    <% }%>
        

                  </tr>
              </tbody>
            </table>
           <%  if(orders[i].is_returned===0){ %>
            <% if (orders[i].is_delivered===true) { %>
         <% const deliveryDate = new Date(orders[i].delivered_date); %>
<% const returnDate = new Date(deliveryDate.getTime() + (14 * 24 * 60 * 60 * 1000)); %>
<% const currentDate = new Date(); %>
<% if (currentDate <= returnDate) { %>
  <a href="/returnOrder?orderId=<%= orders._id %>" class="btn btn-primary">Return order</a>
<% } %>

        <% } else { %>
      <a href="/cancelOrder?orderId=<%=orders[i]._id%>" class="btn btn-danger">Cancel order</a>
      <% } %>
      <%}   else { %>
        
<% } %>
            <a href="/orderDetails?orderId=<%=orders[i]._id%>" class="btn btn-primary">order detalils</a>
            
            <%}%>
      </div>
    </div>
    <%}%>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>



</body>
</html>